<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horror Overlay v4</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Oswald:wght@400;700&family=Roboto+Condensed:wght@400;700&family=Share+Tech+Mono&family=UnifrakturMaguntia&display=swap');

        :root {
            --blood-red: #c90000;
            --dark-red: #5a0000;
            --glass-bg: rgba(8,8,8,0.85);
            --text-main: #f4f4f4;
            --text-muted: #a0a0a0;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            margin: 0; padding: 0; width: 1920px; height: 1080px;
            background: #050505; overflow: hidden; position: relative;
            color: white; font-family: 'Roboto Condensed', sans-serif;
            transition: filter 0.3s ease;
        }
        body.brightened  { filter: brightness(1.6) saturate(0.3) !important; }
        body.screen-shake { animation: screen-shake 0.5s ease forwards; }

        /* WEBCAM */
        #webcam-feed {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 0;
            filter: grayscale(40%) contrast(120%) brightness(80%) sepia(20%) hue-rotate(320deg);
            transform-origin: center center;
            transition: all 1.2s cubic-bezier(0.25, 1, 0.5, 1);
        }
        body.shoutout-mode #webcam-feed {
            animation: shoutout-cam-pulse 14s ease-in-out infinite;
        }
        @keyframes shoutout-cam-pulse {
            0%   { transform: scale(1.00) translate(0px,0px);      filter: grayscale(100%) contrast(110%) brightness(20%) sepia(40%) hue-rotate(320deg); }
            15%  { transform: scale(1.04) translate(-12px, 5px);   filter: grayscale(95%)  contrast(118%) brightness(15%) sepia(55%) hue-rotate(330deg); }
            30%  { transform: scale(1.07) translate(8px, -8px);    filter: grayscale(85%)  contrast(125%) brightness(24%) sepia(30%) hue-rotate(310deg) saturate(160%); }
            45%  { transform: scale(1.05) translate(-5px, 10px);   filter: grayscale(100%) contrast(108%) brightness(12%) sepia(60%) hue-rotate(340deg); }
            60%  { transform: scale(1.09) translate(14px, -4px);   filter: grayscale(90%)  contrast(122%) brightness(22%) sepia(35%) hue-rotate(315deg); }
            75%  { transform: scale(1.04) translate(-8px, 6px);    filter: grayscale(100%) contrast(112%) brightness(16%) sepia(50%) hue-rotate(330deg); }
            88%  { transform: scale(1.02) translate(4px, -3px);    filter: grayscale(95%)  contrast(115%) brightness(19%) sepia(45%) hue-rotate(325deg); }
            100% { transform: scale(1.00) translate(0px,0px);      filter: grayscale(100%) contrast(110%) brightness(20%) sepia(40%) hue-rotate(320deg); }
        }
        body.story-mode #webcam-feed {
            filter: grayscale(30%) contrast(115%) brightness(80%) sepia(10%) hue-rotate(320deg);
        }
        body.fear-max #webcam-feed {
            filter: grayscale(0%) contrast(130%) brightness(70%) sepia(60%) hue-rotate(320deg) saturate(200%);
        }

        /* BROADCAST EFFECTS */
        .vignette { position: absolute; inset: 0; box-shadow: 0 0 250px rgba(0,0,0,0.95) inset; pointer-events: none; z-index: 5; }
        .scanlines { position: absolute; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%), linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06)); background-size: 100% 4px, 6px 100%; pointer-events: none; z-index: 50; opacity: 0.6; }
        #glitch-overlay { position: absolute; inset: 0; background: url('https://media.giphy.com/media/Yy26NRbp8y4ms/giphy.gif'); opacity: 0; pointer-events: none; z-index: 99; mix-blend-mode: screen; filter: grayscale(100%) contrast(150%); transition: opacity 0.1s; }
        .glitching { opacity: 0.15 !important; }
        #flash-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 98; }
        #flash-overlay.red-flash   { animation: flash-red   0.6s ease forwards; }
        #flash-overlay.white-flash { animation: flash-white 0.3s ease forwards; }
        #flash-overlay.dark-flash  { animation: flash-dark  1.2s ease forwards; }

        /* CCTV BUG */
        #cctv-bug { position: absolute; top: 40px; left: 40px; z-index: 10; font-family: 'Share Tech Mono', monospace; font-size: 24px; display: flex; align-items: center; gap: 15px; text-shadow: 2px 2px 5px #000; letter-spacing: 2px; transition: opacity 0.5s; }
        body.shoutout-mode #cctv-bug { opacity: 0; }
        .rec-dot { width: 16px; height: 16px; background: red; border-radius: 50%; box-shadow: 0 0 10px red; animation: blink 1s infinite; }
        .cctv-text { color: var(--text-muted); }

        /* SPONSORS WIDGET â€” redesigned */
        #sponsors-container {
            position: absolute; top: 40px; right: 40px; z-index: 10;
            display: flex; flex-direction: column; align-items: flex-end;
            transition: opacity 0.6s ease;
        }
        body.shoutout-mode #sponsors-container,
        body.story-mode    #sponsors-container,
        body.sponsor-mode  #sponsors-container { opacity: 0; pointer-events: none; }

        .sponsor-badge {
            background: linear-gradient(135deg, rgba(6,3,3,0.92) 0%, rgba(18,6,6,0.88) 100%);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(201,0,0,0.2);
            border-right: none;
            border-top: 2px solid rgba(201,0,0,0.55);
            padding: 14px 22px 14px 20px;
            box-shadow: -8px 8px 40px rgba(0,0,0,0.85), inset 0 0 40px rgba(201,0,0,0.03);
            position: relative; overflow: hidden;
        }
        .sponsor-badge::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(to right, transparent, rgba(201,0,0,0.7), transparent);
        }
        .sponsor-badge::after {
            content: ''; position: absolute; inset: 0;
            background: repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(255,0,0,0.012) 3px,rgba(255,0,0,0.012) 4px);
            pointer-events: none;
        }
        .sponsor-eyebrow {
            font-family: 'Share Tech Mono', monospace;
            font-size: 9px; letter-spacing: 5px; color: rgba(201,0,0,0.5);
            text-transform: uppercase; text-align: right; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: flex-end; gap: 8px;
        }
        .sponsor-eyebrow::before {
            content: ''; display: inline-block; width: 20px; height: 1px;
            background: rgba(201,0,0,0.35);
        }
        .sponsor-images {
            display: flex; gap: 14px; align-items: center; justify-content: flex-end;
        }
        .sponsor-img {
            height: 36px; object-fit: contain;
            filter: brightness(0.9) drop-shadow(0 0 8px rgba(255,255,255,0.15));
            animation: float-logo 4s ease-in-out infinite alternate;
            transition: filter 0.4s;
        }
        .sponsor-img:hover { filter: brightness(1.1) drop-shadow(0 0 14px rgba(201,0,0,0.5)); }
        .sponsor-divider { width: 100%; height: 1px; background: linear-gradient(to right, transparent, rgba(201,0,0,0.2) 50%, transparent); margin: 10px 0; }
        .sponsor-footer-text {
            font-family: 'Share Tech Mono', monospace; font-size: 8px;
            letter-spacing: 3px; color: rgba(255,255,255,0.1);
            text-align: right; text-transform: uppercase;
        }

        /* ================================================================
           SPONSOR MODE â€” FULL SCREEN COMMERCIAL BREAK
        ================================================================ */
        #sponsor-mode-overlay {
            position: absolute; inset: 0; z-index: 70;
            opacity: 0; pointer-events: none;
            transition: opacity 0.8s ease;
            overflow: hidden;
        }
        body.sponsor-mode #sponsor-mode-overlay { opacity: 1; pointer-events: all; }

        /* deep dark bg over webcam */
        #sponsor-mode-overlay::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse 80% 70% at 50% 45%, rgba(20,5,5,0.82) 0%, rgba(0,0,0,0.96) 100%);
            z-index: 0;
        }

        /* top + bottom accent bars */
        .spm-bar-top, .spm-bar-bot {
            position: absolute; left: 0; right: 0; height: 4px; z-index: 2;
            background: linear-gradient(90deg, transparent 0%, var(--blood-red) 15%, var(--blood-red) 85%, transparent 100%);
            box-shadow: 0 0 30px rgba(201,0,0,0.8);
        }
        .spm-bar-top { top: 0; }
        .spm-bar-bot { bottom: 55px; } /* sits above ticker */

        /* corner brackets */
        .spm-corner {
            position: absolute; width: 80px; height: 80px; z-index: 3;
            border-color: rgba(201,0,0,0.45); border-style: solid; border-width: 0;
        }
        .spm-corner.tl { top: 28px; left: 28px; border-top-width: 2px; border-left-width: 2px; }
        .spm-corner.tr { top: 28px; right: 28px; border-top-width: 2px; border-right-width: 2px; }
        .spm-corner.bl { bottom: 72px; left: 28px; border-bottom-width: 2px; border-left-width: 2px; }
        .spm-corner.br { bottom: 72px; right: 28px; border-bottom-width: 2px; border-right-width: 2px; }

        /* main content */
        .spm-content {
            position: absolute; inset: 0; bottom: 55px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 5;
        }

        .spm-pretitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 13px; letter-spacing: 12px; color: rgba(201,0,0,0.6);
            text-transform: uppercase; margin-bottom: 32px;
            opacity: 0; transform: translateY(-12px);
            transition: opacity 0.7s 0.2s ease, transform 0.7s 0.2s ease;
        }
        body.sponsor-mode .spm-pretitle { opacity: 1; transform: translateY(0); }

        /* sponsor slide â€” one at a time */
        #spm-slide {
            display: flex; flex-direction: column; align-items: center; gap: 32px;
            opacity: 0; transform: scale(0.94);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        #spm-slide.visible { opacity: 1; transform: scale(1); }

        .spm-logo-wrap {
            width: 520px; height: 200px;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .spm-logo-wrap::before {
            content: ''; position: absolute; inset: -20px;
            border: 1px solid rgba(201,0,0,0.15); border-radius: 4px;
        }
        .spm-logo-wrap::after {
            content: ''; position: absolute; inset: -4px;
            box-shadow: 0 0 80px rgba(201,0,0,0.12) inset;
        }
        #spm-logo {
            max-width: 480px; max-height: 180px;
            object-fit: contain;
            filter: drop-shadow(0 0 30px rgba(255,255,255,0.25)) drop-shadow(0 0 60px rgba(201,0,0,0.2));
            animation: spm-logo-breathe 3s ease-in-out infinite;
        }
        @keyframes spm-logo-breathe {
            0%,100% { filter: drop-shadow(0 0 30px rgba(255,255,255,0.25)) drop-shadow(0 0 60px rgba(201,0,0,0.2)); }
            50%      { filter: drop-shadow(0 0 45px rgba(255,255,255,0.35)) drop-shadow(0 0 90px rgba(201,0,0,0.35)); }
        }

        .spm-sponsor-name {
            font-family: 'Cinzel', serif; font-size: 58px; font-weight: 800;
            letter-spacing: 8px; color: #fff; text-transform: uppercase; text-align: center;
            text-shadow: 0 0 60px rgba(201,0,0,0.5), 0 0 20px rgba(201,0,0,0.2), 4px 4px 0 rgba(0,0,0,0.9);
            line-height: 1;
        }
        .spm-sponsor-tagline {
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px; letter-spacing: 6px; color: rgba(201,0,0,0.65);
            text-transform: uppercase; text-align: center;
        }

        .spm-divider-line {
            width: 300px; height: 2px; margin: 4px 0;
            background: linear-gradient(to right, transparent, rgba(201,0,0,0.7), transparent);
            box-shadow: 0 0 20px rgba(201,0,0,0.4);
        }

        /* sponsor pagination dots */
        .spm-dots {
            display: flex; gap: 12px; margin-top: 40px;
        }
        .spm-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: rgba(255,255,255,0.15); border: 1px solid rgba(201,0,0,0.25);
            transition: all 0.4s ease;
        }
        .spm-dot.active {
            background: var(--blood-red);
            box-shadow: 0 0 12px rgba(201,0,0,0.8);
            transform: scale(1.3);
        }

        /* countdown bar */
        #spm-countdown-bar {
            position: absolute; bottom: 59px; left: 0; right: 0; height: 3px; z-index: 6;
            background: rgba(201,0,0,0.15);
        }
        #spm-countdown-fill {
            height: 100%; background: var(--blood-red);
            box-shadow: 0 0 10px rgba(201,0,0,0.8);
            width: 100%;
            transition: width linear;
        }

        /* CCTV bug hidden in sponsor mode */
        body.sponsor-mode #cctv-bug { opacity: 0; }
        body.sponsor-mode #emf-widget { opacity: 0; }
        body.sponsor-mode #comment-wrapper { opacity: 0; pointer-events: none; }
        body.sponsor-mode #news-ticker { opacity: 0; }

        /* webcam darkens dramatically in sponsor mode */
        body.sponsor-mode #webcam-feed {
            animation: sponsor-cam-drift 20s ease-in-out infinite;
        }
        @keyframes sponsor-cam-drift {
            0%   { transform: scale(1.05) translate(0,0);      filter: grayscale(100%) contrast(90%) brightness(12%) sepia(50%) hue-rotate(320deg); }
            25%  { transform: scale(1.08) translate(-10px,5px); filter: grayscale(100%) contrast(95%) brightness(10%) sepia(60%) hue-rotate(330deg); }
            50%  { transform: scale(1.06) translate(8px,-6px);  filter: grayscale(100%) contrast(88%) brightness(14%) sepia(45%) hue-rotate(315deg); }
            75%  { transform: scale(1.09) translate(-5px,8px);  filter: grayscale(100%) contrast(92%) brightness(9%)  sepia(55%) hue-rotate(325deg); }
            100% { transform: scale(1.05) translate(0,0);       filter: grayscale(100%) contrast(90%) brightness(12%) sepia(50%) hue-rotate(320deg); }
        }



        /* EMF DETECTOR */
        #emf-widget { position: absolute; right: 40px; bottom: 75px; z-index: 12; width: 200px; background: rgba(5,5,5,0.9); border: 1px solid rgba(0,255,80,0.2); border-top: 2px solid rgba(0,255,80,0.5); padding: 12px 16px 14px; transition: opacity 0.5s; }
        body.shoutout-mode #emf-widget { opacity: 0; }
        body.story-mode #emf-widget { opacity: 0.85; }
        .emf-header { font-family: 'Share Tech Mono', monospace; font-size: 10px; letter-spacing: 4px; color: rgba(0,255,80,0.5); text-transform: uppercase; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .emf-dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(0,255,80,0.4); animation: blink 2s infinite; }
        .emf-dot.spike { background: #ff4400 !important; box-shadow: 0 0 8px #ff4400; animation: blink 0.3s infinite !important; }
        #emf-gauge-wrap { display: flex; justify-content: center; margin-bottom: 8px; }
        #emf-svg { overflow: visible; }
        #emf-needle { transform-origin: 60px 60px; transform: rotate(-80deg); transition: transform 0.4s cubic-bezier(0.25,1,0.5,1); }
        .emf-reading { font-family: 'Share Tech Mono', monospace; font-size: 18px; letter-spacing: 2px; text-align: center; color: rgba(0,255,80,0.7); }
        .emf-reading.danger { color: #ff4400; text-shadow: 0 0 8px #ff4400; }
        .emf-zone-label { font-family: 'Share Tech Mono', monospace; font-size: 9px; letter-spacing: 3px; text-align: center; color: rgba(255,255,255,0.15); margin-top: 4px; }
        .emf-zone-label.active-zone { color: rgba(255,100,0,0.7); }

        /* ==============================================================
           STORY MODE â€” TITLE ONLY + MIC VISUALIZER
        ============================================================== */
        #story-overlay {
            position: absolute; inset: 0; z-index: 8;
            pointer-events: none; opacity: 0;
            transition: opacity 1s ease;
        }
        body.story-mode #story-overlay { opacity: 1; }

        /* Left half dark gradient */
        #story-overlay::before {
            content: '';
            position: absolute; bottom: 0; left: 0; width: 100%; height: 55%;
            background: linear-gradient(to top, rgba(0,0,0,0.92) 0%, rgba(0,0,0,0.55) 60%, transparent 100%);
            z-index: 0;
        }

        /* Mic visualizer canvas â€” bottom left, above title */
        #mic-visualizer {
            position: absolute;
            left: 70px; bottom: 210px;
            z-index: 5; opacity: 0;
            transition: opacity 0.9s 0.6s ease;
        }
        body.story-mode #mic-visualizer { opacity: 1; }

        /* Mic label */
        .mic-status-bar {
            position: absolute;
            left: 70px; bottom: 310px;
            z-index: 5;
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px; letter-spacing: 5px;
            color: rgba(201,0,0,0.55);
            text-transform: uppercase;
            display: flex; align-items: center; gap: 10px;
            opacity: 0; transition: opacity 0.9s 0.8s ease;
        }
        body.story-mode .mic-status-bar { opacity: 1; }
        .mic-dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(201,0,0,0.4); animation: blink 1.5s infinite; }
        .mic-dot.live { background: #00c965; box-shadow: 0 0 6px #00c965; animation: blink 2s infinite; }

        /* Story title â€” bottom-left, big */
        #story-title-block {
            position: absolute;
            left: 70px; bottom: 75px;
            z-index: 5; max-width: 1200px;
            opacity: 0; transform: translateY(28px);
            transition: opacity 0.9s 0.3s ease, transform 0.9s 0.3s cubic-bezier(0.16,1,0.3,1);
        }
        body.story-mode #story-title-block { opacity: 1; transform: translateY(0); }

        .story-title-eyebrow {
            font-family: 'Share Tech Mono', monospace;
            font-size: 13px; letter-spacing: 8px; color: rgba(201,0,0,0.7);
            text-transform: uppercase; margin-bottom: 14px;
            display: flex; align-items: center; gap: 14px;
        }
        .story-title-eyebrow::before {
            content: ''; display: inline-block;
            width: 36px; height: 1px; background: rgba(201,0,0,0.4);
        }

        #story-panel-title {
            font-family: 'Cinzel', serif;
            font-size: 96px; line-height: 0.92; font-weight: 800;
            color: #fff; letter-spacing: 3px; text-transform: uppercase;
            text-shadow: 0 0 100px rgba(201,0,0,0.6), 0 0 30px rgba(201,0,0,0.2), 5px 5px 0 rgba(0,0,0,0.95);
        }

        .story-title-bar {
            width: 200px; height: 4px; margin-top: 20px;
            background: linear-gradient(to right, var(--blood-red) 0%, transparent 100%);
            box-shadow: 0 0 18px rgba(201,0,0,0.6);
        }

        /* ==============================================================
           SHOUTOUT BOARD â€” FULL SCREEN GRID
        ============================================================== */
        #shoutout-board {
            position: absolute; inset: 0; z-index: 60;
            display: flex; flex-direction: column;
            opacity: 0; pointer-events: none;
            transition: opacity 0.7s ease;
            overflow: hidden;
        }
        body.shoutout-mode #shoutout-board { opacity: 1; pointer-events: all; }

        /* Radial glow behind content */
        #shoutout-board::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse 70% 55% at 50% 50%, rgba(35,0,0,0.55) 0%, rgba(0,0,0,0.9) 100%);
            z-index: 0;
        }
        /* Top accent bar */
        #shoutout-board::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, transparent, var(--blood-red) 15%, var(--blood-red) 85%, transparent);
            box-shadow: 0 0 30px rgba(201,0,0,0.9);
            z-index: 1;
        }

        /* --- HEADER --- */
        .so-header {
            position: relative; z-index: 5;
            padding: 38px 90px 0;
            display: flex; align-items: flex-end; justify-content: space-between;
        }
        .so-eyebrow {
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px; letter-spacing: 8px; color: rgba(201,0,0,0.55);
            text-transform: uppercase; margin-bottom: 6px;
        }
        .so-title-row { display: flex; align-items: center; gap: 16px; }
        .so-main-title {
            font-family: 'Cinzel', serif; font-size: 50px; font-weight: 800;
            letter-spacing: 5px; color: #fff; text-transform: uppercase;
            text-shadow: 0 0 50px rgba(201,0,0,0.4), 3px 3px 0 rgba(0,0,0,0.8);
            line-height: 1;
        }
        .so-glyph {
            font-family: 'UnifrakturMaguntia', cursive;
            font-size: 58px; color: var(--blood-red);
            text-shadow: 0 0 40px rgba(201,0,0,0.9); line-height: 1;
            animation: glyph-flicker 6s infinite;
        }
        .so-counter-block { text-align: right; }
        .so-counter-number {
            font-family: 'Cinzel', serif; font-size: 68px; font-weight: 800;
            color: var(--blood-red); text-shadow: 0 0 40px rgba(201,0,0,0.6); line-height: 1;
        }
        .so-counter-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px; letter-spacing: 5px; color: rgba(255,255,255,0.2);
            text-transform: uppercase;
        }

        /* Full-width divider */
        .so-divider {
            position: relative; z-index: 5;
            margin: 18px 90px 0; height: 1px;
            background: linear-gradient(to right, transparent, rgba(201,0,0,0.4) 10%, rgba(201,0,0,0.4) 90%, transparent);
        }
        .so-divider::after {
            content: 'âœ¦';
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            font-size: 12px; color: rgba(201,0,0,0.6);
            background: transparent; padding: 0 14px;
            letter-spacing: 0;
        }

        /* --- NAMES GRID: 3 columns --- */
        .so-grid-wrap {
            position: relative; z-index: 5;
            flex: 1;
            padding: 20px 80px 14px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: 88px;
            gap: 8px 16px;
            align-content: start;
            overflow: hidden;
            mask-image: linear-gradient(to bottom, black 0%, black 82%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 0%, black 82%, transparent 100%);
        }

        .so-name-card {
            position: relative;
            display: flex; align-items: center; gap: 0;
            background: rgba(12,5,5,0.75);
            border: 1px solid rgba(255,255,255,0.04);
            border-left: 3px solid transparent;
            overflow: hidden;
            opacity: 0; transform: translateX(-20px);
            animation: soul-enter 0.5s cubic-bezier(0.16,1,0.3,1) forwards;
            backdrop-filter: blur(6px);
        }
        .so-name-card::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, rgba(201,0,0,0.06) 0%, transparent 40%);
            pointer-events: none;
        }
        .so-name-card.newest {
            background: rgba(30,5,5,0.9);
            border-left-color: var(--blood-red);
            border-color: rgba(201,0,0,0.2);
            box-shadow: 0 0 30px rgba(201,0,0,0.08), inset 0 0 30px rgba(201,0,0,0.04);
        }
        .so-name-card.newest::after {
            background: linear-gradient(90deg, rgba(201,0,0,0.14) 0%, transparent 50%);
        }

        /* Avatar photo */
        .so-avatar-wrap {
            flex-shrink: 0;
            width: 88px; height: 88px;
            overflow: hidden; position: relative;
        }
        .so-avatar-wrap::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to right, transparent 55%, rgba(8,3,3,0.85) 100%);
        }
        .so-avatar-img {
            width: 88px; height: 88px; object-fit: cover;
            filter: grayscale(70%) contrast(1.15) brightness(0.85) sepia(20%) hue-rotate(320deg);
            display: block;
        }
        .so-name-card.newest .so-avatar-img {
            filter: grayscale(40%) contrast(1.2) brightness(0.9) sepia(30%) hue-rotate(320deg);
        }

        /* Text content */
        .so-card-content {
            flex: 1; display: flex; flex-direction: column; justify-content: center;
            padding: 0 14px 0 12px; min-width: 0;
        }
        .so-card-top {
            display: flex; align-items: center; gap: 8px; margin-bottom: 5px;
        }
        .so-name-rank { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: rgba(201,0,0,0.35); flex-shrink: 0; }
        .so-name-glyph { font-size: 10px; opacity: 0.25; flex-shrink: 0; }
        .so-new-badge {
            font-family: 'Share Tech Mono', monospace; font-size: 7px; letter-spacing: 2px;
            color: var(--blood-red); border: 1px solid rgba(201,0,0,0.4);
            background: rgba(201,0,0,0.1); padding: 1px 5px; flex-shrink: 0;
            animation: pulse-opacity 1.2s ease-in-out infinite;
        }
        .so-name-text {
            font-family: 'Oswald', sans-serif; font-size: 19px; font-weight: 400;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: rgba(210,210,210,0.85);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .so-name-card.newest .so-name-text { color: #fff; font-weight: 700; text-shadow: 0 0 14px rgba(201,0,0,0.5); }
        .so-last-comment {
            font-family: 'Roboto Condensed', sans-serif; font-size: 12px;
            color: rgba(150,130,130,0.55); letter-spacing: 0.5px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            font-style: italic; margin-top: 1px;
        }

        /* --- FOOTER --- */
        .so-footer {
            position: relative; z-index: 5;
            padding: 8px 90px 18px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .so-footer::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(to right, transparent, rgba(201,0,0,0.2), transparent); }
        .so-footer-evp { display: flex; gap: 3px; height: 16px; align-items: flex-end; opacity: 0.22; }
        .so-footer-evp .evp-bar { width: 4px; background: var(--blood-red); animation: evp-bounce 1.2s infinite ease-in-out; }
        .so-footer-evp .evp-bar:nth-child(1){animation-delay:0.1s;height:40%}.so-footer-evp .evp-bar:nth-child(2){animation-delay:0.3s;height:80%}.so-footer-evp .evp-bar:nth-child(3){animation-delay:0.0s;height:100%}.so-footer-evp .evp-bar:nth-child(4){animation-delay:0.4s;height:55%}.so-footer-evp .evp-bar:nth-child(5){animation-delay:0.2s;height:70%}
        .so-footer-text { font-family: 'Share Tech Mono', monospace; font-size: 10px; letter-spacing: 4px; color: rgba(255,255,255,0.1); text-transform: uppercase; }

        /* STORY TRANSITION */
        #story-transition { position: absolute; inset: 0; background: #000; z-index: 200; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        #story-transition.active { opacity: 1; pointer-events: all; }
        .transition-text { font-family: 'Cinzel', serif; font-size: 100px; color: var(--blood-red); letter-spacing: 20px; text-shadow: 0 0 40px var(--blood-red), 0 0 10px #fff; transform: scale(0.9); transition: transform 4s cubic-bezier(0.25,1,0.5,1); }
        #story-transition.active .transition-text { transform: scale(1.1); }

        /* WAITING SCREEN */
        #waiting-screen { position: absolute; inset: 0; background: #000; z-index: 300; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.8s ease; }
        #waiting-screen.active { opacity: 1; pointer-events: all; }
        .waiting-bg-noise { position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,0,0,0.012) 2px, rgba(255,0,0,0.012) 4px); z-index: 0; animation: noise-shift 0.4s steps(2) infinite; }
        .waiting-vignette { position: absolute; inset: 0; box-shadow: 0 0 400px rgba(201,0,0,0.35) inset; z-index: 1; pointer-events: none; }
        .waiting-content { position: relative; z-index: 5; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .waiting-eyebrow { font-family: 'Share Tech Mono', monospace; font-size: 16px; letter-spacing: 12px; color: var(--blood-red); text-transform: uppercase; margin-bottom: 30px; animation: pulse-opacity 2s ease-in-out infinite; }
        .waiting-main-title { font-family: 'UnifrakturMaguntia', cursive; font-size: 140px; line-height: 1; color: #fff; text-shadow: 0 0 80px rgba(201,0,0,0.9); letter-spacing: 5px; margin-bottom: 10px; animation: flicker-title 8s infinite; }
        .waiting-sub { font-family: 'Cinzel', serif; font-size: 30px; letter-spacing: 15px; color: var(--blood-red); text-transform: uppercase; margin-bottom: 60px; }
        .waiting-divider { width: 500px; height: 2px; background: linear-gradient(to right, transparent, var(--blood-red), transparent); margin-bottom: 50px; }
        .waiting-status-row { display: flex; align-items: center; gap: 20px; font-family: 'Share Tech Mono', monospace; font-size: 18px; color: var(--text-muted); letter-spacing: 4px; }
        .waiting-dot { width: 10px; height: 10px; background: var(--blood-red); border-radius: 50%; box-shadow: 0 0 8px red; animation: blink 1.2s infinite; }
        .waiting-dots-loader { display: inline-flex; gap: 8px; align-items: center; }
        .waiting-dots-loader span { display: inline-block; width: 6px; height: 6px; background: var(--blood-red); border-radius: 50%; animation: dot-pulse 1.5s ease-in-out infinite; }
        .waiting-dots-loader span:nth-child(1){animation-delay:0s}.waiting-dots-loader span:nth-child(2){animation-delay:0.3s}.waiting-dots-loader span:nth-child(3){animation-delay:0.6s}
        .waiting-corner { position: absolute; width: 120px; height: 120px; z-index: 5; }
        .waiting-corner.tl{top:40px;left:40px;border-top:2px solid rgba(201,0,0,0.5);border-left:2px solid rgba(201,0,0,0.5)}.waiting-corner.tr{top:40px;right:40px;border-top:2px solid rgba(201,0,0,0.5);border-right:2px solid rgba(201,0,0,0.5)}.waiting-corner.bl{bottom:90px;left:40px;border-bottom:2px solid rgba(201,0,0,0.5);border-left:2px solid rgba(201,0,0,0.5)}.waiting-corner.br{bottom:90px;right:40px;border-bottom:2px solid rgba(201,0,0,0.5);border-right:2px solid rgba(201,0,0,0.5)}
        .waiting-drips { position: absolute; top: 0; left: 0; width: 100%; height: 60px; z-index: 6; }
        .drip { position: absolute; top: 0; width: 3px; background: linear-gradient(to bottom, var(--blood-red), #8b0000, transparent); border-radius: 0 0 50% 50%; animation: drip-fall 3s ease-in-out infinite; opacity: 0.6; }
        .drip:nth-child(1){left:8%;height:35px;animation-delay:0s}.drip:nth-child(2){left:15%;height:55px;animation-delay:0.8s}.drip:nth-child(3){left:25%;height:28px;animation-delay:1.5s}.drip:nth-child(4){left:38%;height:45px;animation-delay:0.3s}.drip:nth-child(5){left:52%;height:60px;animation-delay:1.1s}.drip:nth-child(6){left:65%;height:32px;animation-delay:0.6s}.drip:nth-child(7){left:75%;height:48px;animation-delay:2.0s}.drip:nth-child(8){left:85%;height:38px;animation-delay:0.4s}.drip:nth-child(9){left:92%;height:52px;animation-delay:1.7s}

        /* JUMPSCARE */
        #jumpscare-overlay { position: absolute; inset: 0; background: #000; z-index: 500; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; }
        #jumpscare-overlay.active { animation: jumpscare-anim 0.8s ease forwards; }
        .jumpscare-face { font-size: 300px; line-height: 1; filter: brightness(0) invert(1) sepia(1) saturate(5) hue-rotate(320deg); }
        #jumpscare-overlay.active .jumpscare-face { animation: face-shake 0.8s ease forwards; }

        /* RAID ALERT */
        #raid-overlay { position: absolute; inset: 0; background: #000; z-index: 400; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; overflow: hidden; }
        #raid-overlay.active { opacity: 1; pointer-events: all; }
        .raid-bg-lines { position: absolute; inset: 0; background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(201,0,0,0.04) 10px, rgba(201,0,0,0.04) 20px); animation: raid-lines-move 3s linear infinite; }
        .raid-vignette { position: absolute; inset: 0; box-shadow: 0 0 500px rgba(201,0,0,0.6) inset; z-index: 1; }
        .raid-content { position: relative; z-index: 5; display: flex; flex-direction: column; align-items: center; }
        .raid-alert-tag { font-family: 'Share Tech Mono', monospace; font-size: 16px; letter-spacing: 10px; color: var(--blood-red); text-transform: uppercase; border: 1px solid rgba(201,0,0,0.4); padding: 8px 30px; margin-bottom: 24px; animation: pulse-opacity 1s ease-in-out infinite; }
        .raid-main-text { font-family: 'Cinzel', serif; font-size: 110px; font-weight: 800; color: #fff; letter-spacing: 8px; line-height: 0.9; text-shadow: 0 0 80px rgba(201,0,0,0.9), 4px 4px 0 rgba(100,0,0,0.8); text-align: center; animation: flicker-title 3s infinite; }
        .raid-channel-name { font-family: 'Oswald', sans-serif; font-size: 55px; color: var(--blood-red); letter-spacing: 5px; text-transform: uppercase; text-shadow: 0 0 30px rgba(201,0,0,0.8); margin: 10px 0 30px; }
        .raid-sub-text { font-family: 'Share Tech Mono', monospace; font-size: 18px; letter-spacing: 5px; color: rgba(255,255,255,0.4); text-transform: uppercase; }
        .raid-count-display { font-family: 'Share Tech Mono', monospace; font-size: 50px; color: rgba(201,0,0,0.8); letter-spacing: 3px; margin-top: 8px; }
        .raid-scan-line { position: absolute; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, transparent, rgba(201,0,0,0.8), transparent); animation: raid-scan 3s linear infinite; z-index: 6; }

        /* SUPER CHAT */
        #superchat-alert { position: absolute; top: 120px; left: 50%; transform: translateX(-50%) translateY(-30px); min-width: 700px; max-width: 900px; background: linear-gradient(135deg, rgba(8,5,0,0.98), rgba(12,8,0,0.97)); border: 1px solid rgba(255,165,0,0.3); border-top: 3px solid #ff8c00; box-shadow: 0 0 60px rgba(255,100,0,0.25), 0 20px 80px rgba(0,0,0,0.95); z-index: 25; opacity: 0; pointer-events: none; transition: all 0.6s cubic-bezier(0.16,1,0.3,1); overflow: hidden; }
        #superchat-alert.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .sc-top-bar { background: linear-gradient(90deg, #8b4500, #c06000, #8b4500); padding: 10px 28px; display: flex; align-items: center; justify-content: space-between; }
        .sc-label { font-family: 'Share Tech Mono', monospace; font-size: 11px; letter-spacing: 5px; color: rgba(255,200,100,0.9); text-transform: uppercase; }
        .sc-amount { font-family: 'Cinzel', serif; font-size: 22px; font-weight: 800; color: #ffd700; text-shadow: 0 0 10px rgba(255,200,0,0.8); letter-spacing: 3px; }
        .sc-body { padding: 20px 28px 24px; display: flex; align-items: center; gap: 20px; }
        .sc-avatar { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,140,0,0.5); filter: sepia(20%) contrast(1.1); flex-shrink: 0; }
        .sc-author { font-family: 'Oswald', sans-serif; font-size: 26px; color: #ffd700; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; }
        .sc-message { font-family: 'Roboto Condensed', sans-serif; font-size: 20px; color: rgba(240,220,180,0.9); }
        #superchat-alert::before { content: ''; position: absolute; top: 0; left: -100%; width: 60%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,200,0,0.05), transparent); animation: sc-shimmer 3s linear infinite; }

        /* GHOST NOTIFICATION */
        #ghost-notification { position: absolute; right: 40px; bottom: 80px; z-index: 30; background: rgba(5,5,5,0.95); border: 1px solid rgba(201,0,0,0.2); border-left: 3px solid var(--blood-red); padding: 14px 20px; min-width: 320px; max-width: 420px; box-shadow: -10px 10px 40px rgba(0,0,0,0.9); transform: translateX(120%); opacity: 0; transition: all 0.5s cubic-bezier(0.16,1,0.3,1); }
        #ghost-notification.show { transform: translateX(0); opacity: 1; }
        .ghost-notif-header { font-family: 'Share Tech Mono', monospace; font-size: 10px; letter-spacing: 4px; color: rgba(201,0,0,0.6); text-transform: uppercase; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
        .ghost-notif-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--blood-red); animation: blink 0.8s infinite; }
        .ghost-notif-msg { font-family: 'Roboto Condensed', sans-serif; font-size: 18px; color: rgba(230,230,230,0.9); }
        .ghost-notif-time { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: rgba(255,255,255,0.2); letter-spacing: 2px; margin-top: 6px; }

        /* KEYWORD POP */
        #keyword-pop { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) scale(0.6); z-index: 150; font-family: 'Cinzel', serif; font-size: 120px; font-weight: 800; letter-spacing: 10px; text-transform: uppercase; text-align: center; color: #fff; text-shadow: 0 0 60px red, 0 0 20px red; opacity: 0; pointer-events: none; }
        #keyword-pop.pop-in { animation: keyword-pop-anim 1.2s cubic-bezier(0.16,1,0.3,1) forwards; }

        /* COMMENTS */
        #comment-wrapper { position: absolute; bottom: 90px; left: 60px; z-index: 20; width: 750px; transition: transform 0.5s, opacity 0.5s; }
        body.shoutout-mode #comment-wrapper, body.story-mode #comment-wrapper { transform: translateY(200px); opacity: 0; pointer-events: none; }
        .evp-visualizer { display: flex; gap: 3px; height: 15px; margin-bottom: 8px; margin-left: 10px; align-items: flex-end; opacity: 0.7; }
        .evp-bar { width: 4px; background: var(--blood-red); animation: evp-bounce 1.2s infinite ease-in-out; }
        .evp-bar:nth-child(1){animation-delay:0.1s;height:40%}.evp-bar:nth-child(2){animation-delay:0.3s;height:80%}.evp-bar:nth-child(3){animation-delay:0.0s;height:100%}.evp-bar:nth-child(4){animation-delay:0.4s;height:60%}.evp-bar:nth-child(5){animation-delay:0.2s;height:50%}
        #comment-container { background: linear-gradient(90deg, var(--glass-bg) 0%, rgba(15,15,15,0.6) 100%); backdrop-filter: blur(15px); border-left: 6px solid var(--blood-red); box-shadow: 20px 20px 50px rgba(0,0,0,0.9); display: flex; transform: translateX(-120%); opacity: 0; transition: all 0.7s cubic-bezier(0.25,1,0.5,1); overflow: hidden; }
        #comment-container.show { transform: translateX(0); opacity: 1; }
        .avatar-box { background: #000; padding: 20px; display: flex; align-items: center; justify-content: center; border-right: 1px solid rgba(255,255,255,0.05); }
        .avatar { width: 70px; height: 70px; border-radius: 4px; object-fit: cover; filter: grayscale(80%) contrast(1.2); box-shadow: 0 0 15px rgba(201,0,0,0.5); }
        .content-box { padding: 20px 30px; display: flex; flex-direction: column; justify-content: center; width: 100%; }
        .comment-author { font-family: 'Oswald', sans-serif; font-size: 24px; font-weight: 700; color: var(--blood-red); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px; }
        .comment-text { font-family: 'Roboto Condensed', sans-serif; font-size: 22px; line-height: 1.4; color: var(--text-main); }

        /* NEWS TICKER */
        #news-ticker { position: absolute; bottom: 0; left: 0; width: 100%; height: 55px; background: #080808; border-top: 2px solid var(--blood-red); display: flex; align-items: center; overflow: hidden; z-index: 40; box-shadow: 0 -10px 30px rgba(0,0,0,0.8); transition: opacity 0.5s; }
        body.shoutout-mode #news-ticker { opacity: 0; }
        .ticker-label { background: var(--blood-red); color: #fff; font-family: 'Oswald', sans-serif; font-weight: 700; font-size: 22px; padding: 0 30px; height: 100%; display: flex; align-items: center; letter-spacing: 2px; z-index: 45; box-shadow: 10px 0 20px rgba(0,0,0,0.5); flex-shrink: 0; }
        .ticker-wrapper { white-space: nowrap; display: inline-block; padding-left: 20px; animation: scroll-ticker 30s linear infinite; }
        .ticker-text { font-family: 'Roboto Condensed', sans-serif; font-size: 24px; color: var(--text-main); text-transform: uppercase; letter-spacing: 2px; padding-right: 60px; }
        .ticker-highlight { color: var(--blood-red); font-weight: 700; }

        /* KEYFRAMES */
        @keyframes scroll-ticker { 0%{transform:translateX(100vw)} 100%{transform:translateX(-100%)} }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
        @keyframes evp-bounce { 0%,100%{height:30%} 50%{height:100%} }
        @keyframes float-logo { 0%{transform:translateY(0)} 100%{transform:translateY(-3px)} }
        @keyframes soul-enter { from{opacity:0;transform:translateX(-20px)} to{opacity:1;transform:translateX(0)} }
        @keyframes glyph-flicker { 0%,18%,20%,22%,60%,62%,100%{opacity:1} 19%,21%,61%{opacity:0.7;text-shadow:none} }
        @keyframes pulse-opacity { 0%,100%{opacity:0.6} 50%{opacity:1} }
        @keyframes flicker-title { 0%,19%,21%,23%,54%,56%,100%{opacity:1} 20%,24%,55%{opacity:0.85} }
        @keyframes noise-shift { 0%{background-position:0 0} 100%{background-position:0 4px} }
        @keyframes drip-fall { 0%{transform:scaleY(0.3);opacity:0} 30%{opacity:0.7} 70%{transform:scaleY(1);opacity:0.6} 100%{transform:scaleY(0.3);opacity:0} }
        @keyframes dot-pulse { 0%,100%{opacity:0.2;transform:scale(0.8)} 50%{opacity:1;transform:scale(1.2)} }
        @keyframes screen-shake { 0%{transform:translate(0,0)} 15%{transform:translate(-8px,5px)} 30%{transform:translate(8px,-5px)} 45%{transform:translate(-6px,3px)} 60%{transform:translate(6px,-3px)} 100%{transform:translate(0,0)} }
        @keyframes jumpscare-anim { 0%{opacity:0} 5%{opacity:1} 80%{opacity:1} 100%{opacity:0} }
        @keyframes face-shake { 0%{transform:rotate(-3deg) scale(1.1)} 20%{transform:rotate(3deg) scale(1.15)} 60%{transform:rotate(-2deg) scale(1.1)} 100%{transform:rotate(0) scale(1)} }
        @keyframes raid-lines-move { 0%{background-position:0 0} 100%{background-position:40px 40px} }
        @keyframes raid-scan { 0%{top:-3px} 100%{top:100%} }
        @keyframes sc-shimmer { 0%{left:-100%} 100%{left:200%} }
        @keyframes keyword-pop-anim { 0%{opacity:0;transform:translate(-50%,-50%) scale(0.5)} 20%{opacity:1;transform:translate(-50%,-50%) scale(1.05)} 50%{opacity:1;transform:translate(-50%,-50%) scale(1)} 80%{opacity:1} 100%{opacity:0;transform:translate(-50%,-50%) scale(1.1)} }
        @keyframes flash-red   { 0%{background:rgba(180,0,0,0.35)} 100%{background:rgba(180,0,0,0)} }
        @keyframes flash-white { 0%{background:rgba(255,255,255,0.8)} 100%{background:rgba(255,255,255,0)} }
        @keyframes flash-dark  { 0%{background:rgba(0,0,0,0.85)} 100%{background:rgba(0,0,0,0)} }
    </style>
</head>
<body>

    <video id="webcam-feed" autoplay muted playsinline></video>
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div id="glitch-overlay"></div>
    <div id="flash-overlay"></div>

    <audio id="horror-sfx"    src="creepy-whoosh.mp3" preload="auto"></audio>
    <audio id="jumpscare-sfx" src="jumpscare.mp3"      preload="auto"></audio>
    <audio id="emf-beep"      src="emf-beep.mp3"       preload="auto"></audio>
    <audio id="raid-sfx"      src="raid-alert.mp3"     preload="auto"></audio>
    <audio id="superchat-sfx" src="superchat.mp3"      preload="auto"></audio>

    <!-- STORY TRANSITION -->
    <div id="story-transition"><div class="transition-text">NEXT STORY</div></div>

    <!-- JUMPSCARE -->
    <div id="jumpscare-overlay"><div class="jumpscare-face">ðŸ’€</div></div>

    <!-- RAID -->
    <div id="raid-overlay">
        <div class="raid-bg-lines"></div><div class="raid-vignette"></div><div class="raid-scan-line"></div>
        <div class="raid-content">
            <div class="raid-alert-tag">âš  Incoming Signal âš </div>
            <div class="raid-main-text">YOU ARE<br>BEING RAIDED</div>
            <div class="raid-channel-name" id="raid-channel-name">Unknown Raider</div>
            <div class="raid-sub-text">SOULS INCOMING</div>
            <div class="raid-count-display" id="raid-viewer-count">???</div>
        </div>
        <div class="scanlines" style="z-index:7;opacity:0.3;"></div>
    </div>

    <!-- SUPER CHAT -->
    <div id="superchat-alert">
        <div class="sc-top-bar">
            <div class="sc-label">âš¡ Super Chat Received</div>
            <div class="sc-amount" id="sc-amount">â‚±0.00</div>
        </div>
        <div class="sc-body">
            <img class="sc-avatar" id="sc-avatar" src="https://via.placeholder.com/64/111/fff?text=?" alt="">
            <div>
                <div class="sc-author" id="sc-author">Anonymous</div>
                <div class="sc-message" id="sc-message">â€”</div>
            </div>
        </div>
    </div>

    <div id="keyword-pop"></div>

    <!-- WAITING SCREEN -->
    <div id="waiting-screen">
        <div class="waiting-bg-noise"></div><div class="waiting-vignette"></div>
        <div class="waiting-drips">
            <div class="drip"></div><div class="drip"></div><div class="drip"></div>
            <div class="drip"></div><div class="drip"></div><div class="drip"></div>
            <div class="drip"></div><div class="drip"></div><div class="drip"></div>
        </div>
        <div class="waiting-corner tl"></div><div class="waiting-corner tr"></div>
        <div class="waiting-corner bl"></div><div class="waiting-corner br"></div>
        <div class="waiting-content">
            <div class="waiting-eyebrow">âš  Broadcast Initializing âš </div>
            <div class="waiting-main-title">Huwag Matulog</div>
            <div class="waiting-sub">Storytelling Night</div>
            <div class="waiting-divider"></div>
            <div class="waiting-status-row">
                <div class="waiting-dot"></div>
                <span>STREAM STARTING SOON</span>
                <div class="waiting-dots-loader"><span></span><span></span><span></span></div>
            </div>
        </div>
        <div class="scanlines" style="z-index:6;opacity:0.4;"></div>
    </div>

    <!-- CCTV BUG -->
    <div id="cctv-bug">
        <div class="rec-dot"></div>
        <span>REC</span>
        <span class="cctv-text">| CAM 04 - TALIM ISLAND |</span>
        <span class="cctv-clock" id="live-clock">00:00:00</span>
    </div>

    <!-- SPONSORS WIDGET -->
    <div id="sponsors-container">
        <div class="sponsor-badge">
            <div class="sponsor-eyebrow">Sponsored By</div>
            <div class="sponsor-images" id="sponsor-images">
                <img src="https://via.placeholder.com/120x36/1a0000/cc0000?text=SPONSOR" alt="Sponsor" class="sponsor-img">
            </div>
            <div class="sponsor-divider"></div>
            <div class="sponsor-footer-text">Official Partner</div>
        </div>
    </div>

    <!-- EMF DETECTOR -->
    <div id="emf-widget">
        <div class="emf-header"><span>EMF RDR-6</span><div class="emf-dot" id="emf-status-dot"></div></div>
        <div id="emf-gauge-wrap">
            <svg id="emf-svg" width="120" height="70" viewBox="0 0 120 70">
                <path d="M 10 65 A 50 50 0 0 1 110 65" fill="none" stroke="rgba(0,255,80,0.08)" stroke-width="8" stroke-linecap="round"/>
                <path d="M 10 65 A 50 50 0 0 1 45 22"  fill="none" stroke="rgba(0,200,60,0.25)"  stroke-width="8" stroke-linecap="round"/>
                <path d="M 45 22 A 50 50 0 0 1 80 18"  fill="none" stroke="rgba(255,180,0,0.25)" stroke-width="8" stroke-linecap="round"/>
                <path d="M 80 18 A 50 50 0 0 1 110 65" fill="none" stroke="rgba(255,50,0,0.3)"   stroke-width="8" stroke-linecap="round"/>
                <text x="8"  y="62" fill="rgba(0,255,80,0.35)" font-size="7" font-family="monospace">LOW</text>
                <text x="90" y="62" fill="rgba(255,50,0,0.5)"  font-size="7" font-family="monospace">MAX</text>
                <g id="emf-needle">
                    <line x1="60" y1="65" x2="60" y2="22" stroke="rgba(0,255,80,0.9)" stroke-width="2" stroke-linecap="round"/>
                    <circle cx="60" cy="65" r="4" fill="rgba(0,255,80,0.4)" stroke="rgba(0,255,80,0.6)" stroke-width="1"/>
                </g>
            </svg>
        </div>
        <div class="emf-reading" id="emf-reading">0.0 mG</div>
        <div class="emf-zone-label" id="emf-zone-label">NO ACTIVITY</div>
    </div>

    <!-- ================================================================
         STORY MODE OVERLAY â€” title + mic visualizer only
    ================================================================ -->
    <div id="story-overlay">
        <div class="mic-status-bar">
            <span class="mic-dot" id="mic-dot"></span>
            <span id="mic-label-text">MIC CONNECTINGâ€¦</span>
        </div>
        <canvas id="mic-visualizer"></canvas>
        <div id="story-title-block">
            <div class="story-title-eyebrow">Now Telling</div>
            <div id="story-panel-title">KWENTONG GABI</div>
            <div class="story-title-bar"></div>
        </div>
    </div>

    <!-- ================================================================
         SHOUTOUT â€” full screen grid
    ================================================================ -->
    <div id="shoutout-board">
        <div class="so-header">
            <div>
                <div class="so-eyebrow">Live Witnesses</div>
                <div class="so-title-row">
                    <div class="so-main-title">Souls Acknowledged</div>
                    <div class="so-glyph">â€ </div>
                </div>
            </div>
            <div class="so-counter-block">
                <div class="so-counter-number" id="soul-count">0</div>
                <div class="so-counter-label">souls in broadcast</div>
            </div>
        </div>
        <div class="so-divider"></div>
        <div class="so-grid-wrap" id="shoutout-list"></div>
        <div class="so-footer">
            <div class="so-footer-evp">
                <div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div>
                <div class="evp-bar"></div><div class="evp-bar"></div>
            </div>
            <div class="so-footer-text">Huwag Matulog Storytelling â€” Thank you for watching</div>
            <div class="so-footer-evp">
                <div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div>
                <div class="evp-bar"></div><div class="evp-bar"></div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         SPONSOR MODE â€” FULL SCREEN COMMERCIAL BREAK
    ================================================================ -->
    <div id="sponsor-mode-overlay">
        <div class="spm-bar-top"></div>
        <div class="spm-bar-bot"></div>
        <div class="spm-corner tl"></div>
        <div class="spm-corner tr"></div>
        <div class="spm-corner bl"></div>
        <div class="spm-corner br"></div>
        <div class="scanlines" style="z-index:1;opacity:0.45;"></div>
        <div class="spm-content">
            <div class="spm-pretitle">This Broadcast Is Brought To You By</div>
            <div id="spm-slide">
                <div class="spm-logo-wrap">
                    <img id="spm-logo" src="https://via.placeholder.com/400x140/1a0000/cc0000?text=SPONSOR" alt="">
                </div>
                <div class="spm-divider-line"></div>
                <div class="spm-sponsor-name" id="spm-name">SPONSOR</div>
                <div class="spm-sponsor-tagline" id="spm-tagline">Official Partner of Huwag Matulog</div>
            </div>
            <div class="spm-dots" id="spm-dots"></div>
        </div>
        <div id="spm-countdown-bar"><div id="spm-countdown-fill"></div></div>
    </div>
    <div id="comment-wrapper">
        <div class="evp-visualizer">
            <div class="evp-bar"></div><div class="evp-bar"></div>
            <div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div>
        </div>
        <div id="comment-container">
            <div class="avatar-box">
                <img src="https://via.placeholder.com/70/111/fff?text=?" alt="" class="avatar" id="comment-avatar">
            </div>
            <div class="content-box">
                <div class="comment-author" id="comment-author">System Loading</div>
                <div class="comment-text" id="comment-text">Establishing connection...</div>
            </div>
        </div>
    </div>

    <!-- GHOST NOTIFICATION -->
    <div id="ghost-notification">
        <div class="ghost-notif-header"><div class="ghost-notif-dot"></div><span>SYSTEM ALERT</span></div>
        <div class="ghost-notif-msg" id="ghost-notif-msg">Unknown presence detected</div>
        <div class="ghost-notif-time" id="ghost-notif-time">00:00:00</div>
    </div>

    <!-- NEWS TICKER -->
    <div id="news-ticker">
        <div class="ticker-label">LIVE ALERT</div>
        <div class="ticker-wrapper">
            <span class="ticker-text">YOU ARE WATCHING A LIVE STORYTELLING BROADCAST. <span class="ticker-highlight">SUBSCRIBE NOW</span> TO SUPPORT THE CHANNEL.</span>
            <span class="ticker-text">DO NOT WATCH THIS ALONE. <span class="ticker-highlight">LIKE AND SUBSCRIBE</span> IF YOU SURVIVE THE NIGHT.</span>
            <span class="ticker-text">TYPE <span class="ticker-highlight">TAKOT</span> IN THE CHAT IF YOU FEEL IT TOO.</span>
        </div>
    </div>

<script>
// ======================================================================
// CONFIG
// ======================================================================
let API_KEY  = 'AIzaSyBADtw_0ahV9nKATpBRq9mCgbU1_vqnyFI';
let VIDEO_ID = '0NdX9x0AQSQ';

function loadSavedSettings() {
    const v = localStorage.getItem('horror_video_id');
    const s = localStorage.getItem('horror_sponsors');
    if (v) VIDEO_ID = v;
    if (s) renderSponsors(JSON.parse(s));
}
function renderSponsors(list) {
    const c = document.getElementById('sponsor-images');
    c.innerHTML = '';
    (list||[]).forEach(s => {
        const img = document.createElement('img');
        img.src = s.url; img.alt = s.alt || 'Sponsor';
        img.className = 'sponsor-img';
        if (s.tagline) img.dataset.tagline = s.tagline;
        img.onerror = () => img.style.display = 'none';
        c.appendChild(img);
    });
}
loadSavedSettings();

// ======================================================================
// BROADCAST CHANNEL
// ======================================================================
const bc = new BroadcastChannel('horror-overlay-ctrl');
bc.addEventListener('message', e => {
    const m = e.data; if (!m || !m.type) return;
    if (m.type === 'UPDATE_VIDEO_ID') {
        VIDEO_ID = m.videoId; localStorage.setItem('horror_video_id', VIDEO_ID);
        liveChatId = ''; nextPageToken = ''; commentQueue = [];
        getLiveChatId();
    }
    if (m.type === 'UPDATE_SPONSORS') {
        localStorage.setItem('horror_sponsors', JSON.stringify(m.sponsors));
        renderSponsors(m.sponsors);
    }
    if (m.type === 'UPDATE_STORY_TEXT') {
        document.getElementById('story-panel-title').textContent = m.title || 'KWENTONG GABI';
    }
});

// ======================================================================
// 1. WEBCAM
// ======================================================================
async function startWebcam() {
    try {
        const s = await navigator.mediaDevices.getUserMedia({ video: { width:1920, height:1080 } });
        document.getElementById('webcam-feed').srcObject = s;
    } catch(e) { console.error('Camera:', e); }
}
startWebcam();

// ======================================================================
// 2. KEYBOARD  W=Wait S=Shout T=Story N=Trans J=Jump R=Raid P=Sponsor
// ======================================================================
let isTransitioning=false, isWaiting=false, isStoryMode=false, isShoutout=false, isSponsor=false;

document.addEventListener('keydown', e => {
    const k = e.key.toUpperCase();
    if (k==='W') toggleWaiting();
    if (k==='S') toggleShoutout();
    if (k==='T') toggleStoryMode();
    if (k==='N' && !isTransitioning) triggerStoryTransition();
    if (k==='J') triggerJumpscare();
    if (k==='R') triggerRaidAlert('Unknown Raider','???');
    if (k==='P') toggleSponsorMode();
});

function toggleWaiting() {
    isWaiting = !isWaiting;
    document.getElementById('waiting-screen').classList.toggle('active', isWaiting);
}
function toggleShoutout() {
    isShoutout = !isShoutout;
    document.body.classList.toggle('shoutout-mode', isShoutout);
    if (isShoutout) updateShoutoutBoard();
}
function toggleStoryMode() {
    isStoryMode = !isStoryMode;
    document.body.classList.toggle('story-mode', isStoryMode);
    if (isStoryMode) startMicVisualizer();
    else             stopMicVisualizer();
}
function triggerStoryTransition() {
    isTransitioning = true;
    tryPlay('horror-sfx');
    const t = document.getElementById('story-transition');
    t.classList.add('active');
    setTimeout(() => { t.classList.remove('active'); setTimeout(() => { isTransitioning=false; }, 500); }, 4500);
}

// ======================================================================
// SPONSOR MODE
// ======================================================================
let sponsorList = [];          // [{ url, alt, tagline }]
let spmIndex    = 0;
let spmTimer    = null;
const SPM_DURATION = 8000;    // ms per sponsor slide

function toggleSponsorMode() {
    isSponsor = !isSponsor;
    document.body.classList.toggle('sponsor-mode', isSponsor);
    if (isSponsor) startSponsorMode();
    else           stopSponsorMode();
}

function startSponsorMode() {
    // Build list from current sponsor images
    const imgs = document.querySelectorAll('#sponsor-images .sponsor-img');
    sponsorList = Array.from(imgs).map(img => ({
        url: img.src, alt: img.alt || 'Sponsor',
        tagline: img.dataset.tagline || 'Official Partner of Huwag Matulog'
    }));
    if (sponsorList.length === 0) {
        sponsorList = [{ url: 'https://via.placeholder.com/400x140/1a0000/cc0000?text=SPONSOR', alt: 'SPONSOR', tagline: 'Official Partner of Huwag Matulog' }];
    }
    spmIndex = 0;
    buildDots();
    showSlide(spmIndex);
}

function stopSponsorMode() {
    clearTimeout(spmTimer);
    const slide = document.getElementById('spm-slide');
    slide.classList.remove('visible');
}

function buildDots() {
    const wrap = document.getElementById('spm-dots');
    wrap.innerHTML = '';
    sponsorList.forEach((_, i) => {
        const d = document.createElement('div');
        d.className = 'spm-dot' + (i === 0 ? ' active' : '');
        wrap.appendChild(d);
    });
}

function showSlide(idx) {
    if (!isSponsor) return;
    const slide   = document.getElementById('spm-slide');
    const logo    = document.getElementById('spm-logo');
    const name    = document.getElementById('spm-name');
    const tagline = document.getElementById('spm-tagline');
    const fill    = document.getElementById('spm-countdown-fill');
    const dots    = document.querySelectorAll('.spm-dot');

    // fade out
    slide.classList.remove('visible');

    setTimeout(() => {
        const sp = sponsorList[idx];
        logo.src          = sp.url;
        logo.alt          = sp.alt;
        name.textContent  = sp.alt.toUpperCase();
        tagline.textContent = sp.tagline || 'Official Partner of Huwag Matulog';

        // activate dot
        dots.forEach((d,i) => d.classList.toggle('active', i===idx));

        // countdown bar animation
        fill.style.transition = 'none';
        fill.style.width = '100%';
        requestAnimationFrame(() => requestAnimationFrame(() => {
            fill.style.transition = `width ${SPM_DURATION}ms linear`;
            fill.style.width = '0%';
        }));

        // fade in
        slide.classList.add('visible');

        // schedule next slide
        spmTimer = setTimeout(() => {
            if (!isSponsor) return;
            spmIndex = (spmIndex + 1) % sponsorList.length;
            showSlide(spmIndex);
        }, SPM_DURATION);
    }, 400);
}

// ======================================================================
// 3. SHOUTOUT â€” GRID
// ======================================================================
// Map<name, { avatar: string, lastComment: string }>  â€” insertion-order = chronological
let uniqueCommenters = new Map();
const SOUL_ICONS = ['â€ ','â˜½','âœ¦','â‚','âœ§','â˜©','âš°','âœ','âš¡','âœµ','â§','âšœ'];
const FALLBACK_AVT = 'https://via.placeholder.com/88/110000/cc0000?text=%3F';

function updateShoutoutBoard() {
    const grid  = document.getElementById('shoutout-list');
    const count = document.getElementById('soul-count');
    count.textContent = uniqueCommenters.size;
    grid.innerHTML = '';

    if (uniqueCommenters.size === 0) {
        const e = document.createElement('div');
        e.className = 'so-name-card';
        e.style.cssText = 'opacity:0.3;animation:none;grid-column:1/-1;justify-content:center;';
        e.innerHTML = `<div class="so-card-content"><span class="so-name-text" style="text-align:center;font-size:15px;letter-spacing:6px;color:rgba(255,255,255,0.25);">AWAITING VICTIMSâ€¦</span></div>`;
        grid.appendChild(e);
        return;
    }

    // newest first
    const entries = Array.from(uniqueCommenters.entries()).reverse();
    entries.forEach(([name, data], i) => {
        const card = document.createElement('div');
        card.className = 'so-name-card' + (i === 0 ? ' newest' : '');
        card.style.animationDelay = `${Math.min(i * 0.055, 1.4)}s`;
        const rank = uniqueCommenters.size - i;
        const avatar = data.avatar || FALLBACK_AVT;
        const lastComment = data.lastComment || '';
        card.innerHTML = `
            <div class="so-avatar-wrap">
                <img class="so-avatar-img" src="${avatar}" alt="" onerror="this.src='${FALLBACK_AVT}'">
            </div>
            <div class="so-card-content">
                <div class="so-card-top">
                    <span class="so-name-rank">${String(rank).padStart(2,'0')}</span>
                    <span class="so-name-glyph">${SOUL_ICONS[i % SOUL_ICONS.length]}</span>
                    ${i === 0 ? '<span class="so-new-badge">NEW</span>' : ''}
                </div>
                <div class="so-name-text">${name}</div>
                ${lastComment ? `<div class="so-last-comment">${lastComment.substring(0,48)}${lastComment.length>48?'â€¦':''}</div>` : ''}
            </div>
        `;
        grid.appendChild(card);
    });
}

// ======================================================================
// 4. CLOCK & GLITCH
// ======================================================================
function updateClock() {
    document.getElementById('live-clock').innerText =
        new Date().toLocaleTimeString('en-US', {hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit'});
}
setInterval(updateClock, 1000); updateClock();

function triggerRandomGlitch() {
    const g = document.getElementById('glitch-overlay');
    g.classList.add('glitching');
    setTimeout(() => g.classList.remove('glitching'), 100 + Math.random()*200);
    setTimeout(triggerRandomGlitch, 10000 + Math.random()*15000);
}
setTimeout(triggerRandomGlitch, 5000);

// ======================================================================
// 5. FEAR METER
// ======================================================================
let fearLevel = 0;
const FEAR_PER_COMMENT = 4;

function setFear(v) {
    fearLevel = Math.max(0, Math.min(100, v));
    if (fearLevel < 75) {
        document.body.classList.remove('fear-max');
    } else {
        if (fearLevel >= 100) { document.body.classList.add('fear-max'); triggerRandomGlitch(); }
    }
}
function addFear(n) { setFear(fearLevel + n); }
setInterval(() => { if (fearLevel > 0) setFear(fearLevel - 6); }, 20000);

// ======================================================================
// 6. MIC AUDIO VISUALIZER (Web Audio API â€” real voice)
// ======================================================================
let micCtx=null, micAnalyser=null, micStream=null, micRaf=null, micActive=false;

async function startMicVisualizer() {
    if (micActive) return;
    const canvas = document.getElementById('mic-visualizer');
    const dot    = document.getElementById('mic-dot');
    const label  = document.getElementById('mic-label-text');

    // size the canvas
    canvas.width  = 840;
    canvas.height = 88;

    try {
        // Request MIC (audio only, separate from webcam stream)
        micStream   = await navigator.mediaDevices.getUserMedia({ audio: { echoCancellation: false, noiseSuppression: false }, video: false });
        micCtx      = new (window.AudioContext || window.webkitAudioContext)();
        micAnalyser = micCtx.createAnalyser();
        micAnalyser.fftSize = 512;
        micAnalyser.smoothingTimeConstant = 0.75;

        const src = micCtx.createMediaStreamSource(micStream);
        src.connect(micAnalyser);

        dot.className     = 'mic-dot live';
        label.textContent = 'MIC LIVE';
        micActive = true;
        drawLiveMic(canvas, micAnalyser);

    } catch(err) {
        console.warn('Mic blocked:', err);
        dot.className     = 'mic-dot';
        label.textContent = 'MIC â€” ALLOW PERMISSIONS';
        micActive = true; // still draw idle
        drawIdleMic(canvas);
    }
}

function stopMicVisualizer() {
    micActive = false;
    if (micRaf)    { cancelAnimationFrame(micRaf); micRaf = null; }
    if (micStream) { micStream.getTracks().forEach(t => t.stop()); micStream = null; }
    if (micCtx)    { micCtx.close(); micCtx = null; }
    micAnalyser = null;
    const c = document.getElementById('mic-visualizer');
    c.getContext('2d').clearRect(0, 0, c.width, c.height);
    document.getElementById('mic-dot').className     = 'mic-dot';
    document.getElementById('mic-label-text').textContent = 'MIC CONNECTINGâ€¦';
}

function drawLiveMic(canvas, analyser) {
    const ctx    = canvas.getContext('2d');
    const bufLen = analyser.frequencyBinCount; // 256
    const data   = new Uint8Array(bufLen);
    const W = canvas.width, H = canvas.height;
    const NUM = 96;
    const barW = Math.floor((W / NUM)) - 1;
    const step = Math.floor(bufLen / NUM);

    function draw() {
        if (!micActive) return;
        micRaf = requestAnimationFrame(draw);
        analyser.getByteFrequencyData(data);
        ctx.clearRect(0, 0, W, H);

        for (let i = 0; i < NUM; i++) {
            // average a block of frequencies for smoother look
            let sum = 0;
            for (let j = 0; j < step; j++) sum += data[i * step + j] || 0;
            const avg = sum / step;
            const t   = avg / 255; // 0..1
            const bH  = Math.max(2, t * H * 0.92);
            const x   = i * (barW + 1);

            // bar color: dim red â†’ bright orange-red
            const r = Math.round(150 + t * 105);
            const alpha = 0.25 + t * 0.75;
            ctx.fillStyle = `rgba(${r},${Math.round(t*30)},0,${alpha})`;
            ctx.fillRect(x, H - bH, barW, bH);

            // bright top cap when loud
            if (t > 0.5) {
                ctx.fillStyle = `rgba(255,${Math.round(t*60)},0,${(t-0.5)*1.2})`;
                ctx.fillRect(x, H - bH, barW, 2);
            }
        }

        // Faint mirror reflection
        ctx.save();
        ctx.globalAlpha = 0.12;
        ctx.transform(1, 0, 0, -0.18, 0, H * 1.18);
        ctx.drawImage(canvas, 0, 0);
        ctx.restore();
    }
    draw();
}

function drawIdleMic(canvas) {
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const NUM = 96; const barW = Math.floor(W / NUM) - 1;
    let t = 0;
    function idle() {
        if (!micActive) return;
        micRaf = requestAnimationFrame(idle);
        t += 0.04;
        ctx.clearRect(0, 0, W, H);
        for (let i = 0; i < NUM; i++) {
            const wave = (Math.sin(i * 0.25 + t) * 0.5 + 0.5) * (Math.sin(i * 0.07 - t*0.5) * 0.3 + 0.7);
            const bH   = 2 + wave * 8;
            ctx.fillStyle = `rgba(201,0,0,${0.1 + wave * 0.12})`;
            ctx.fillRect(i * (barW + 1), H - bH, barW, bH);
        }
    }
    idle();
}

// ======================================================================
// 7. KEYWORD REACTIONS
// ======================================================================
const KEYWORD_MAP = [
    [/\b(takot|nakakatakot|natatakot)\b/i, () => { addFear(15); triggerFlash('red-flash'); showKeywordPop('ðŸ˜± TAKOT!'); }],
    [/\b(putangina|puta|gago|tangina|wtf|fck|fuck)\b/i, () => { addFear(10); document.body.classList.add('screen-shake'); setTimeout(()=>document.body.classList.remove('screen-shake'),600); triggerFlash('red-flash'); }],
    [/\b(huwag|wag|stop|tigil)\b/i, () => { addFear(8); triggerFlash('dark-flash'); showKeywordPop('HUWAGâ€¦'); }],
    [/\b(ilaw|lights|bukas)\b/i, () => { document.body.classList.add('brightened'); setTimeout(()=>document.body.classList.remove('brightened'),2000); showKeywordPop('ðŸ’¡ ILAW'); }],
    [/\b(multo|patay|ghost|kaluluwa|dead)\b/i, () => { addFear(20); triggerFlash('red-flash'); triggerRandomGlitch(); showKeywordPop('ðŸ‘»'); }],
    [/\b(laban|tuloy|go|sige|tara)\b/i, () => { addFear(5); showKeywordPop('TULOY!'); }],
];
function checkKeywords(text) {
    for (const [re,fn] of KEYWORD_MAP) { if (re.test(text)) { fn(); break; } }
}
function triggerFlash(cls) {
    const f = document.getElementById('flash-overlay');
    f.className = cls;
    setTimeout(() => { f.className = ''; }, 800);
}
let kwT = null;
function showKeywordPop(text) {
    const el = document.getElementById('keyword-pop');
    clearTimeout(kwT); el.className = ''; el.textContent = text;
    void el.offsetWidth; el.className = 'pop-in';
    kwT = setTimeout(() => { el.className=''; }, 1200);
}

// ======================================================================
// 8. EMF
// ======================================================================
let emfTarget=20, emfCur=20, emfSpiking=false;
function updateEMF() {
    emfCur += (emfTarget-emfCur)*0.1 + (Math.random()-0.5)*4;
    emfCur  = Math.max(0, Math.min(100, emfCur));
    document.getElementById('emf-needle').style.transform = `rotate(${-80+(emfCur/100)*160}deg)`;
    const r = document.getElementById('emf-reading');
    const z = document.getElementById('emf-zone-label');
    const d = document.getElementById('emf-status-dot');
    r.textContent = (emfCur*0.85).toFixed(1)+' mG';
    if (emfCur < 25) { r.className='emf-reading'; z.textContent='NO ACTIVITY'; z.className='emf-zone-label'; d.className='emf-dot'; }
    else if (emfCur < 60) { r.className='emf-reading'; z.textContent='PRESENCE NEARBY'; z.className='emf-zone-label active-zone'; d.className='emf-dot'; }
    else {
        r.className='emf-reading danger'; z.textContent='âš  ENTITY DETECTED'; z.className='emf-zone-label active-zone'; d.className='emf-dot spike';
        if (!emfSpiking) { emfSpiking=true; tryPlay('emf-beep'); addFear(12); triggerFlash('red-flash'); setTimeout(()=>{emfSpiking=false;},5000); }
    }
}
function randomEMFTarget() {
    const r=Math.random();
    if (r<0.6) emfTarget=5+Math.random()*25; else if(r<0.85) emfTarget=30+Math.random()*30; else emfTarget=70+Math.random()*30;
    setTimeout(randomEMFTarget, 3000+Math.random()*8000);
}
setInterval(updateEMF, 150); setTimeout(randomEMFTarget, 4000);

// ======================================================================
// 9. JUMPSCARE (J)
// ======================================================================
const FACES=['ðŸ’€','ðŸ‘ï¸','ðŸ˜±','ðŸ•·ï¸','â˜ ï¸'];
let jLock=false;
function triggerJumpscare() {
    if(jLock) return; jLock=true;
    const ov=document.getElementById('jumpscare-overlay');
    ov.querySelector('.jumpscare-face').textContent=FACES[Math.floor(Math.random()*FACES.length)];
    tryPlay('jumpscare-sfx'); triggerFlash('white-flash');
    ov.classList.add('active'); addFear(25);
    setTimeout(()=>{ ov.classList.remove('active'); setTimeout(()=>{jLock=false;},300); }, 800);
}

// ======================================================================
// 10. RAID (R)
// ======================================================================
let rLock=false;
function triggerRaidAlert(ch,cnt) {
    if(rLock) return; rLock=true;
    document.getElementById('raid-channel-name').textContent = ch.toUpperCase();
    document.getElementById('raid-viewer-count').textContent = cnt+' VIEWERS';
    tryPlay('raid-sfx');
    const ov=document.getElementById('raid-overlay');
    ov.classList.add('active'); addFear(30);
    setTimeout(()=>{ ov.classList.remove('active'); setTimeout(()=>{rLock=false;},500); }, 8000);
}

// ======================================================================
// 11. SUPER CHAT
// ======================================================================
let scQ=[],scBusy=false;
function showSuperChat(author,msg,amount,avatar) { scQ.push({author,msg,amount,avatar}); processSCQueue(); }
function processSCQueue() {
    if(scBusy||!scQ.length) return; scBusy=true;
    const sc=scQ.shift();
    document.getElementById('sc-author').textContent  = sc.author;
    document.getElementById('sc-message').textContent = sc.msg||'(No message)';
    document.getElementById('sc-amount').textContent  = sc.amount;
    document.getElementById('sc-avatar').src          = sc.avatar||'https://via.placeholder.com/64/111/fff?text=?';
    tryPlay('superchat-sfx'); addFear(15);
    const el=document.getElementById('superchat-alert');
    el.classList.add('show');
    setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>{scBusy=false;processSCQueue();},800); }, 9000);
}

// ======================================================================
// 12. GHOST NOTIFICATIONS
// ======================================================================
const GHOST_MSGS=[
    'Unknown viewer has joined the broadcast',
    'âš  Unusual activity detected â€” CAM 04',
    'Signal interference on channel 04',
    'An unknown entity is watching you',
    'Motion detected at perimeter',
    'âš  Temperature drop: âˆ’12Â°C in your area',
    'CAM 04 feed interrupted for 0.3s',
    'Electromagnetic anomaly recorded',
    'Someone typed a message â€” then deleted it',
    'âš  You are not alone in this room',
    'Viewer count is higher than expected',
    'âš  Anomalous signal from nearby location',
];
function showGhostNotif(msg) {
    const el=document.getElementById('ghost-notification');
    document.getElementById('ghost-notif-msg').textContent  = msg;
    document.getElementById('ghost-notif-time').textContent = new Date().toLocaleTimeString('en-US',{hour12:false});
    el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'), 4500);
}
function scheduleGhost() {
    setTimeout(()=>{ showGhostNotif(GHOST_MSGS[Math.floor(Math.random()*GHOST_MSGS.length)]); scheduleGhost(); }, 90000+Math.random()*150000);
}
setTimeout(()=>showGhostNotif(GHOST_MSGS[0]), 30000);
scheduleGhost();

// ======================================================================
// 13. YOUTUBE LIVE CHAT API
// ======================================================================
let liveChatId='',nextPageToken='',commentQueue=[],isShowingComment=false;

async function getLiveChatId() {
    if (!VIDEO_ID||!API_KEY) return;
    try {
        const r=await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${VIDEO_ID}&key=${API_KEY}`);
        const d=await r.json();
        if (d.items&&d.items[0]&&d.items[0].liveStreamingDetails) {
            liveChatId=d.items[0].liveStreamingDetails.activeLiveChatId;
            if (liveChatId) { fetchMessages(); setInterval(fetchMessages,7000); }
        }
    } catch(e) { console.error('getLiveChatId:',e); }
}

async function fetchMessages() {
    if (!liveChatId) return;
    let url=`https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${liveChatId}&part=snippet,authorDetails&key=${API_KEY}`;
    if (nextPageToken) url+=`&pageToken=${nextPageToken}`;
    try {
        const r=await fetch(url); const d=await r.json();
        if (d.nextPageToken) {
            const first=!nextPageToken; nextPageToken=d.nextPageToken;
            if (!first&&d.items&&d.items.length) {
                d.items.forEach(item => {
                    const name=item.authorDetails.displayName;
                    const text=item.snippet.displayMessage||'';
                    const type=item.snippet.type;
                    const avatar=item.authorDetails.profileImageUrl||'';
                    // Update map â€” keep oldest entry's order, always refresh avatar+comment
                    if (!uniqueCommenters.has(name)) {
                        uniqueCommenters.set(name, { avatar, lastComment: text });
                    } else {
                        // update avatar and last comment but keep insertion order
                        const existing = uniqueCommenters.get(name);
                        uniqueCommenters.delete(name);
                        uniqueCommenters.set(name, { avatar, lastComment: text });
                    }
                    document.getElementById('soul-count').textContent=uniqueCommenters.size;
                    addFear(FEAR_PER_COMMENT); checkKeywords(text);
                    if (type==='superChatEvent') {
                        const a=item.snippet.superChatDetails;
                        showSuperChat(name, a?.userComment||'', a?.amountDisplayString||'???', avatar);
                    }
                    commentQueue.push({author:name,text,avatar});
                });
                processCommentQueue();
            }
        }
    } catch(e) { console.error('fetchMessages:',e); }
}

function processCommentQueue() {
    if (isShowingComment||!commentQueue.length||isShoutout||isStoryMode) return;
    isShowingComment=true;
    const c=commentQueue.shift();
    document.getElementById('comment-author').innerText=c.author;
    document.getElementById('comment-text').innerText  =c.text;
    document.getElementById('comment-avatar').src      =c.avatar||'https://via.placeholder.com/70/111/fff?text=?';
    document.getElementById('comment-container').classList.add('show');
    setTimeout(()=>{
        document.getElementById('comment-container').classList.remove('show');
        setTimeout(()=>{ isShowingComment=false; processCommentQueue(); },1000);
    }, 6000);
}

getLiveChatId();

// ======================================================================
// AUDIO HELPER
// ======================================================================
function tryPlay(id) {
    const a=document.getElementById(id); if(!a) return;
    a.currentTime=0; a.play().catch(()=>{});
}
document.addEventListener('click',()=>{
    ['horror-sfx','jumpscare-sfx','emf-beep','raid-sfx','superchat-sfx']
        .forEach(id=>{ const a=document.getElementById(id); if(a) a.load(); });
},{once:true});
</script>
</body>
</html>
