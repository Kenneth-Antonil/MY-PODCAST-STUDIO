<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Cinematic Broadcast - WEBCAM INTEGRATED</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Oswald:wght@400;700&family=Roboto+Condensed:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --blood-red: #c90000;
            --dark-red: #5a0000;
            --glass-bg: rgba(8, 8, 8, 0.85);
            --text-main: #f4f4f4;
            --text-muted: #a0a0a0;
        }

        body {
            margin: 0; padding: 0; width: 1920px; height: 1080px;
            background-color: #050505; /* Black na ang background dahil nandito na ang camera */
            overflow: hidden; position: relative;
            color: white; font-family: 'Roboto Condensed', sans-serif;
        }

        /* --- WEBCAM FEED (Nasa likod ng lahat) --- */
        #webcam-feed {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 0;
            /* Horror Filter sa Camera mo */
            filter: grayscale(40%) contrast(120%) brightness(80%) sepia(20%) hue-rotate(320deg);
            transform-origin: center left;
            transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* Kapag in-activate ang Shoutout (Letter 'S') */
        body.shoutout-mode #webcam-feed {
            transform: perspective(1500px) rotateY(15deg) scale(0.65) translateX(5%) translateY(-5%);
            box-shadow: 30px 30px 100px rgba(0,0,0,1);
            border: 4px solid var(--dark-red);
            border-radius: 15px;
            filter: grayscale(80%) contrast(150%) brightness(60%);
        }

        /* --- SHOUTOUT BOARD (Nasa Kanan) --- */
        #shoutout-board {
            position: absolute; top: 15%; right: 5%; width: 500px; height: 65%;
            background: linear-gradient(135deg, rgba(15,0,0,0.95), rgba(5,5,5,0.95));
            border: 2px solid var(--blood-red);
            border-left: 8px solid var(--blood-red);
            box-shadow: -20px 20px 60px rgba(0,0,0,0.9);
            z-index: 15; padding: 40px; display: flex; flex-direction: column;
            transform: translateX(150%) rotateY(-20deg); opacity: 0;
            transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
        body.shoutout-mode #shoutout-board {
            transform: translateX(0) rotateY(0deg); opacity: 1;
        }
        .shoutout-header {
            font-family: 'Cinzel', serif; font-size: 35px; color: var(--blood-red);
            text-align: center; letter-spacing: 5px; border-bottom: 2px dashed var(--dark-red);
            padding-bottom: 20px; margin-bottom: 20px; text-shadow: 0 0 10px red;
        }
        #shoutout-list {
            list-style: none; padding: 0; margin: 0; overflow-y: hidden;
            display: flex; flex-direction: column; gap: 15px;
        }
        .shoutout-item {
            font-family: 'Oswald', sans-serif; font-size: 28px; color: #fff;
            letter-spacing: 2px; text-transform: uppercase;
            animation: slideInLeft 0.5s ease forwards; opacity: 0;
        }

        /* --- BROADCAST EFFECTS --- */
        .vignette { position: absolute; top: 0; left: 0; width: 100%; height: 100%; box-shadow: 0 0 250px rgba(0,0,0,0.95) inset; pointer-events: none; z-index: 5; }
        .scanlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 4px, 6px 100%; pointer-events: none; z-index: 50; opacity: 0.6; }
        #glitch-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('https://media.giphy.com/media/Yy26NRbp8y4ms/giphy.gif'); opacity: 0; pointer-events: none; z-index: 99; mix-blend-mode: screen; filter: grayscale(100%) contrast(150%); }
        .glitching { opacity: 0.12 !important; }

        /* --- OTHERS (CCTV, Sponsors, Comments, Transition) --- */
        #cctv-bug { position: absolute; top: 40px; left: 40px; z-index: 10; font-family: 'Share Tech Mono', monospace; color: #fff; font-size: 24px; display: flex; align-items: center; gap: 15px; text-shadow: 2px 2px 5px #000; letter-spacing: 2px; }
        .rec-dot { width: 16px; height: 16px; background-color: red; border-radius: 50%; box-shadow: 0 0 10px red; animation: blink 1s infinite; }
        .cctv-text { color: var(--text-muted); }
        .cctv-clock { font-weight: bold; color: #fff; }

        #sponsors-container { position: absolute; top: 40px; right: 40px; z-index: 10; background: var(--glass-bg); backdrop-filter: blur(10px); border-left: 3px solid var(--blood-red); padding: 15px 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); display: flex; flex-direction: column; align-items: flex-end; transition: opacity 0.5s; }
        body.shoutout-mode #sponsors-container { opacity: 0; /* Itago ang sponsors pag may shoutout */ }
        .sponsor-title { font-family: 'Oswald', sans-serif; color: var(--text-muted); font-size: 12px; letter-spacing: 4px; text-transform: uppercase; margin-bottom: 10px; }
        .sponsor-images { display: flex; gap: 15px; align-items: center; }
        .sponsor-img { height: 40px; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); animation: float-logo 4s ease-in-out infinite alternate; }

        #story-transition { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000000; z-index: 200; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease-in-out; }
        #story-transition.active { opacity: 1; pointer-events: all; }
        .transition-text { font-family: 'Cinzel', serif; font-size: 100px; color: var(--blood-red); letter-spacing: 20px; text-shadow: 0 0 40px var(--blood-red), 0 0 10px #fff; transform: scale(0.9); transition: transform 4s cubic-bezier(0.25, 1, 0.5, 1); }
        #story-transition.active .transition-text { transform: scale(1.1); }

        #comment-wrapper { position: absolute; bottom: 90px; left: 60px; z-index: 20; width: 750px; transition: transform 0.5s; }
        body.shoutout-mode #comment-wrapper { transform: translateY(200px); /* Itago ang comments pag shoutout */ }
        .evp-visualizer { display: flex; gap: 3px; height: 15px; margin-bottom: 8px; margin-left: 10px; align-items: flex-end; opacity: 0.7; }
        .evp-bar { width: 4px; background: var(--blood-red); animation: evp-bounce 1.2s infinite ease-in-out; }
        .evp-bar:nth-child(1) { animation-delay: 0.1s; height: 40%; } .evp-bar:nth-child(2) { animation-delay: 0.3s; height: 80%; } .evp-bar:nth-child(3) { animation-delay: 0.0s; height: 100%; } .evp-bar:nth-child(4) { animation-delay: 0.4s; height: 60%; } .evp-bar:nth-child(5) { animation-delay: 0.2s; height: 50%; }

        #comment-container { background: linear-gradient(90deg, var(--glass-bg) 0%, rgba(15,15,15,0.6) 100%); backdrop-filter: blur(15px); border-left: 6px solid var(--blood-red); box-shadow: 20px 20px 50px rgba(0,0,0,0.9); padding: 0; display: flex; flex-direction: row; transform: translateX(-120%); opacity: 0; transition: all 0.7s cubic-bezier(0.25, 1, 0.5, 1); overflow: hidden; }
        #comment-container.show { transform: translateX(0); opacity: 1; }
        .avatar-box { background: #000; padding: 20px; display: flex; align-items: center; justify-content: center; border-right: 1px solid rgba(255,255,255,0.05); }
        .avatar { width: 70px; height: 70px; border-radius: 4px; object-fit: cover; filter: grayscale(80%) contrast(1.2); box-shadow: 0 0 15px rgba(201, 0, 0, 0.5); }
        .content-box { padding: 20px 30px; display: flex; flex-direction: column; justify-content: center; width: 100%; }
        .comment-author { font-family: 'Oswald', sans-serif; font-size: 24px; font-weight: 700; color: var(--blood-red); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px; }
        .comment-text { font-family: 'Roboto Condensed', sans-serif; font-size: 22px; line-height: 1.4; color: var(--text-main); }

        #news-ticker { position: absolute; bottom: 0; left: 0; width: 100%; height: 55px; background: #080808; border-top: 2px solid var(--blood-red); display: flex; align-items: center; overflow: hidden; z-index: 40; box-shadow: 0 -10px 30px rgba(0,0,0,0.8); }
        .ticker-label { background: var(--blood-red); color: #fff; font-family: 'Oswald', sans-serif; font-weight: 700; font-size: 22px; padding: 0 30px; height: 100%; display: flex; align-items: center; letter-spacing: 2px; position: relative; z-index: 45; box-shadow: 10px 0 20px rgba(0,0,0,0.5); }
        .ticker-wrapper { white-space: nowrap; display: inline-block; padding-left: 20px; animation: scroll-ticker 30s linear infinite; }
        .ticker-text { font-family: 'Roboto Condensed', sans-serif; font-weight: 400; font-size: 24px; color: var(--text-main); text-transform: uppercase; letter-spacing: 2px; padding-right: 60px; }
        .ticker-highlight { color: var(--blood-red); font-weight: 700; }

        @keyframes scroll-ticker { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes evp-bounce { 0%, 100% { height: 30%; } 50% { height: 100%; } }
        @keyframes float-logo { 0% { transform: translateY(0); } 100% { transform: translateY(-3px); } }
        @keyframes slideInLeft { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

    <video id="webcam-feed" autoplay muted playsinline></video>

    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div id="glitch-overlay"></div> 

    <audio id="horror-sfx" src="creepy-whoosh.mp3" preload="auto"></audio>

    <div id="story-transition">
        <div class="transition-text" id="transition-text">NEXT STORY</div>
    </div>

    <div id="cctv-bug">
        <div class="rec-dot"></div>
        <span>REC</span>
        <span class="cctv-text">| CAM 04 - TALIM ISLAND |</span>
        <span class="cctv-clock" id="live-clock">00:00:00</span>
    </div>

    <div id="sponsors-container">
        <div class="sponsor-title">Sponsored By</div>
        <div class="sponsor-images">
            <img src="https://via.placeholder.com/120x40/222/fff?text=Sponsor+1" alt="Sponsor 1" class="sponsor-img">
        </div>
    </div>

    <div id="shoutout-board">
        <div class="shoutout-header">SOULS ACKNOWLEDGED</div>
        <ul id="shoutout-list">
            <li class="shoutout-item" style="color: gray;">Awaiting victims...</li>
        </ul>
    </div>

    <div id="comment-wrapper">
        <div class="evp-visualizer">
            <div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div><div class="evp-bar"></div>
        </div>
        <div id="comment-container">
            <div class="avatar-box">
                <img src="https://via.placeholder.com/70/111/fff?text=?" alt="Avatar" class="avatar" id="comment-avatar">
            </div>
            <div class="content-box">
                <div class="comment-author" id="comment-author">System Loading</div>
                <div class="comment-text" id="comment-text">Establishing connection...</div>
            </div>
        </div>
    </div>

    <div id="news-ticker">
        <div class="ticker-label">LIVE ALERT</div>
        <div class="ticker-wrapper">
            <span class="ticker-text">YOU ARE WATCHING A LIVE STORYTELLING BROADCAST. <span class="ticker-highlight">SUBSCRIBE NOW</span> TO SUPPORT THE CHANNEL.</span>
            <span class="ticker-text">DO NOT WATCH THIS ALONE. <span class="ticker-highlight">LIKE AND SUBSCRIBE</span> IF YOU SURVIVE THE NIGHT.</span>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBADtw_0ahV9nKATpBRq9mCgbU1_vqnyFI'; 
        const VIDEO_ID = '0NdX9x0AQSQ'; 
        
        // ==========================================
        // 1. WEBCAM INITIALIZATION
        // ==========================================
        async function startWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1920, height: 1080 } });
                document.getElementById('webcam-feed').srcObject = stream;
            } catch (err) {
                console.error("Camera Error: Please allow camera permissions in OBS.", err);
                document.getElementById('shoutout-list').innerHTML = `<li class="shoutout-item" style="color:red; font-size:20px;">Error: Camera blocked. Allow permissions.</li>`;
            }
        }
        startWebcam();

        // ==========================================
        // 2. KEYBOARD CONTROLS (N = Next Story, S = Shoutout)
        // ==========================================
        let isTransitioning = false;
        
        document.addEventListener('keydown', function(event) {
            // TRANSITION HOTKEY (N)
            if ((event.key === 'n' || event.key === 'N') && !isTransitioning) {
                triggerStoryTransition();
            }
            // SHOUTOUT HOTKEY (S)
            if (event.key === 's' || event.key === 'S') {
                toggleShoutoutMode();
            }
        });

        function triggerStoryTransition() {
            isTransitioning = true;
            const transLayer = document.getElementById('story-transition');
            const sfx = document.getElementById('horror-sfx');
            sfx.currentTime = 0; sfx.play().catch(e => console.log("Audio blocked. Click interact."));
            transLayer.classList.add('active');
            setTimeout(() => { transLayer.classList.remove('active'); setTimeout(() => { isTransitioning = false; }, 500); }, 4500); 
        }

        function toggleShoutoutMode() {
            document.body.classList.toggle('shoutout-mode');
            updateShoutoutBoard();
        }

        // ==========================================
        // 3. SHOUTOUT DATA COLLECTOR
        // ==========================================
        let uniqueCommenters = new Set(); // Iniipon natin dito yung mga nag-comment

        function updateShoutoutBoard() {
            const listElement = document.getElementById('shoutout-list');
            listElement.innerHTML = ''; // Clear list
            
            if (uniqueCommenters.size === 0) {
                listElement.innerHTML = `<li class="shoutout-item" style="color: gray;">No victims yet...</li>`;
                return;
            }

            // Ipakita ang latest 10 na nag-comment
            let delay = 0;
            Array.from(uniqueCommenters).slice(-10).reverse().forEach(name => {
                const li = document.createElement('li');
                li.className = 'shoutout-item';
                li.innerHTML = `â€¢ ${name}`;
                li.style.animationDelay = `${delay}s`;
                listElement.appendChild(li);
                delay += 0.2; // Cascade animation
            });
        }

        // ==========================================
        // 4. CLOCK & GLITCH
        // ==========================================
        function updateClock() { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit' }); }
        setInterval(updateClock, 1000); updateClock();

        function triggerRandomGlitch() {
            const glitchDiv = document.getElementById('glitch-overlay');
            glitchDiv.classList.add('glitching');
            setTimeout(() => { glitchDiv.classList.remove('glitching'); }, 100 + Math.random() * 200);
            setTimeout(triggerRandomGlitch, 10000 + Math.random() * 15000);
        }
        setTimeout(triggerRandomGlitch, 5000);

        // ==========================================
        // 5. YOUTUBE API LOGIC
        // ==========================================
        let liveChatId = ''; let nextPageToken = ''; let commentQueue = []; let isShowingComment = false;

        async function getLiveChatId() {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${VIDEO_ID}&key=${API_KEY}`);
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    liveChatId = data.items[0].liveStreamingDetails.activeLiveChatId;
                    fetchMessages(); setInterval(fetchMessages, 7000); 
                }
            } catch (error) { console.error("Error fetching Live Chat:", error); }
        }

        async function fetchMessages() {
            if (!liveChatId) return;
            let url = `https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${liveChatId}&part=snippet,authorDetails&key=${API_KEY}`;
            if (nextPageToken) url += `&pageToken=${nextPageToken}`;
            try {
                const response = await fetch(url); const data = await response.json();
                if (data.nextPageToken) {
                    const isFirstLoad = (nextPageToken === ''); nextPageToken = data.nextPageToken;
                    if (!isFirstLoad && data.items && data.items.length > 0) {
                        data.items.forEach(item => {
                            const authorName = item.authorDetails.displayName;
                            uniqueCommenters.add(authorName); // Add sa Shoutout List
                            
                            commentQueue.push({ author: authorName, text: item.snippet.displayMessage, avatar: item.authorDetails.profileImageUrl });
                        }); processCommentQueue();
                    }
                }
            } catch (error) { console.error("Error fetching messages:", error); }
        }

        function processCommentQueue() {
            if (isShowingComment || commentQueue.length === 0) return;
            isShowingComment = true; const comment = commentQueue.shift();
            
            // Wag palabasin ang comments box kung naka-shoutout mode para hindi makalat
            if (document.body.classList.contains('shoutout-mode')) {
                isShowingComment = false; processCommentQueue(); return;
            }

            document.getElementById('comment-author').innerText = comment.author;
            document.getElementById('comment-text').innerText = comment.text;
            document.getElementById('comment-avatar').src = comment.avatar || "https://via.placeholder.com/70/111/fff?text=?";
            document.getElementById('comment-container').classList.add('show');
            setTimeout(() => { document.getElementById('comment-container').classList.remove('show'); setTimeout(() => { isShowingComment = false; processCommentQueue(); }, 1000); }, 6000); 
        }

        getLiveChatId();
    </script>
</body>
</html>
